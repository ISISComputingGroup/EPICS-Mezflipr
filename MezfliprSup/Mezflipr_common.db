record(bo, "$(P)SIM")
{
    field(SCAN, "Passive")
    field(DTYP, "Soft Channel")
    field(ZNAM, "NO")
    field(ONAM, "YES")
    field(VAL, "$(RECSIM=0)")
    field(PINI, "YES")
}
    
record(bo, "$(P)DISABLE") 
{
    field(DESC, "Disable comms")
    field(PINI, "YES")
    field(VAL, "$(DISABLE=0)")
    field(OMSL, "supervisory")
    field(ZNAM, "COMMS ENABLED")
    field(ONAM, "COMMS DISABLED")
}

record(stringin, "$(P)ID")
{
    field(DESC, "Device ID")
    field(DTYP, "stream")
    field(INP,  "@Mezflipr.proto getIDN $(PORT)")
    field(SCAN, "10 second")
    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:ID")
    field(SDIS, "$(P)DISABLE")
}

record(mbbi, "$(P)TOGGLE") {
    field(DESC, "Toggle flipper state")
    field(ZRST, "Analyser Off Pol. Off")
    field(ZRVL, "0")
    field(ONST, "Analyser Off Pol. On")
    field(ONVL, "1")
    field(TWST, "Analyser On Pol. Off")
    field(TWVL, "2")
    field(THST, "Analyser On Pol. On")
    field(THVL, "3")
    field(ZRVL, "0")
    field(ONVL, "1")
    field(TWVL, "2")
    field(THVL, "3")
    field(DTYP, "stream")
    field(INP, "@Mezflipr.proto getToggle $(PORT)")
    field(SCAN, "2 second")
    
    info(interest, "HIGH")
    info(archive, "VAL")
    
    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:TOGGLE")
    field(SDIS, "$(P)DISABLE")
}

record(mbbo, "$(P)TOGGLE:SP") {
    field(ZRST, "Analyser Off Pol. Off")
    field(ZRVL, "0")
    
    $(IFNOTANALYSERPRESENT) $(IFPOLARISERPRESENT) field(ONST, "Analyser Off Pol. On")
    $(IFNOTANALYSERPRESENT) $(IFPOLARISERPRESENT) field(ONVL, "1")
    
    $(IFANALYSERPRESENT) $(IFNOTPOLARISERPRESENT) field(ONST, "Analyser On Pol. Off")
    $(IFANALYSERPRESENT) $(IFNOTPOLARISERPRESENT) field(ONVL, "2")
    
    $(IFANALYSERPRESENT) $(IFPOLARISERPRESENT) field(ONST, "Analyser Off Pol. On")
    $(IFANALYSERPRESENT) $(IFPOLARISERPRESENT) field(ONVL, "1")
    $(IFANALYSERPRESENT) $(IFPOLARISERPRESENT) field(TWST, "Analyser On Pol. Off")
    $(IFANALYSERPRESENT) $(IFPOLARISERPRESENT) field(TWVL, "2")
    $(IFANALYSERPRESENT) $(IFPOLARISERPRESENT) field(THST, "Analyser On Pol. On")
    $(IFANALYSERPRESENT) $(IFPOLARISERPRESENT) field(THVL, "3")
    
    field(DTYP, "stream")
    field(OUT, "@Mezflipr.proto setToggle $(PORT)")
    
    field(SIML, "$(P)SIM")
    field(SIOL, "$(P)SIM:TOGGLE:SP")
    field(SDIS, "$(P)DISABLE")
}

record(stringout, "$(P)SIM:ID") {
    field("VAL", "recsim flipper")
    field("PINI", "YES")
}

record(mbbo, "$(P)SIM:TOGGLE") {}
alias("$(P)SIM:TOGGLE", "$(P)SIM:TOGGLE:SP")
